# sign request for csv upload
csvUpload:
    handler: backend/functions/csv/upload.handler
    memorySize: 256
    timeout: 28
    role: CsvUtilsRole
    environment:
        S3_BUCKET: !Ref ListProcessingBucket
    events:
        # get the signed request for uploader
        - httpApi:
              path: /csv/sign
              method: POST
              authorizer:
                  type: request
                  name: CognitoAuth
        - httpApi:
              path: /csv/startupload
              method: POST
              authorizer:
                  type: request
                  name: CognitoAuth
        # upload end
        - httpApi:
              path: /csv/completeupload
              method: POST
              authorizer:
                  type: request
                  name: CognitoAuth

# check an uploaded CSV, return first row and total rows
csvCheck:
    handler: backend/functions/csv/check.handler
    memorySize: 512
    timeout: 28
    role: CsvUtilsRole
    environment:
        S3_BUCKET: !Ref ListProcessingBucket
    events:
        - httpApi:
              path: /csv/check
              method: GET
              authorizer:
                  type: request
                  name: CognitoAuth

# private bulk validator
csvSubmit:
    handler: backend/functions/csv/submit.handler
    timeout: 28
    role: CsvUtilsRole
    environment:
        DDB_TABLE: !Ref Table
        S3_BUCKET: !Ref ListProcessingBucket
    events:
        # create
        - httpApi:
              path: /csv/submit
              method: POST
              authorizer:
                  type: request
                  name: CognitoAuth
